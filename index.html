<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Daily Generate Report</title>
    <link href="yeti.jpg" rel="icon">
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/css/style2.css" rel="stylesheet">
    <style>
        .toggle-btn.active {
            background-color: #8b7355;
            color: white;
        }

        .report-area {
            height: 80%;
            min-height: 420px;
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar d-md-none px-2">
        <button class="navbar-toggler border-0" type="button" id="mobileSidebarToggle">
            <i class="bi bi-list display-6" style="color: var(--text-navbar);"></i>
        </button>
        <div class="profile mx-2">
            <img id="nav-profile-img" src="yeti.jpg" alt="Profile" class="img-fluid rounded-circle"
                style="width:40px;height:40px;object-fit:cover;">
        </div>
    </nav>

    <div class="container-fluid p-1 p-md-3">
        <div class="d-flex">

            <!-- Sidebar -->
            <div id="left-sidebar"
                class="card cozy-card rounded-4 shadow-sm border-0 p-3 me-3 d-none d-md-flex flex-column">
                <div class="sidebar-page d-flex flex-column h-100">
                    <div class="text-center mb-3 cozy-profile">
                        <img id="sidebar-profile-img" src="yeti.jpg" alt="" class="img-fluid rounded-4">
                        <p id="sidebar-username" class="mb-0 fw-semibold text-light">User</p>
                    </div>
                    <div class="sidebar-menu flex-grow-1">
                        <ul class="list-unstyled mb-0">
                            <li class="mb-2"><a href="index.html" class="p-2 rounded-3 text-decoration-none active"><i
                                        class="bi bi-speedometer2"></i><span>Dashboard</span></a></li>
                            <li class="mb-2"><a href="collection.html" class="p-2 rounded-3 text-decoration-none"><i
                                        class="bi bi-collection"></i><span>Collection</span></a></li>
                            <li class="mb-2"><a href="webmail.html" class="p-2 rounded-3 text-decoration-none"><i
                                        class="bi bi-envelope"></i><span>Webmail</span></a></li>
                            <li class="mb-2"><a href="settings.html" class="p-2 rounded-3 text-decoration-none"><i
                                        class="bi bi-gear"></i><span>Settings</span></a></li>
                        </ul>
                    </div>
                    <div id="sidebar-footer" class="sidebar-footer text-center py-2">
                        &copy; <span id="footer-year"></span> <span class="footer-extra">| Designed by Philip Arland
                            Alili</span>
                    </div>
                </div>
            </div>

            <!-- Main -->
            <div class="flex-grow-1">
                <div class="d-flex justify-content-between align-items-center py-2 py-md-2 px-2">
                    <div class="text-start">
                        <h5 id="welcomeMsg" class="mb-0">Welcome, User</h5>
                        <p id="paydayMsg" class="text-muted">Loading...</p>
                    </div>
                    <div class="text-end">
                        <h5 id="currentDate" class="fw-semibold mb-0"></h5>
                        <h6 id="currentTime" class="mb-0"></h6>
                    </div>
                </div>


                <div class="cozy-card card rounded-4 shadow-sm border-0 p-4">
                    <h4 class="mb-4">Ez Report</h4>

                    <div class="row g-4">

                        <!-- LEFT COLUMN -->
                        <div class="col-md-6">

                            <!-- Toggle Buttons -->
                            <div class="mb-3 d-flex justify-content-between gap-2">
                                <div class="report">
                                    <button id="btnCollection"
                                        class="btns btn-primary toggle-btn active">Collection</button>
                                    <button id="btnEmails" class="btns btn-primary toggle-btn">Emails</button>
                                    <button id="btnWebmails" class="btns btn-primary toggle-btn">Webmails</button>
                                </div>

                                <div class="reset">
                                    <button id="resetBtn" class="btns btn-danger">
                                        <i class="bi bi-arrow-clockwise"></i> Reset
                                    </button>
                                </div>
                            </div>

                            <!-- COLLECTION -->
                            <div id="collectionSection">
                                <h5 class="mb-3">Company Collection</h5>

                                <!-- Country/State toggle -->
                                <div class="input-group mb-2">
                                    <button class="btns btn-primary" id="toggleColLocation" type="button">
                                        <i class="bi bi-arrow-repeat"></i>
                                    </button>
                                    <input type="text" id="colLocation" class="form-control">
                                </div>

                                <input type="text" id="colMarket" class="form-control mb-2"
                                    placeholder="Market Segment">
                                <input type="number" id="colCompanyCount" class="form-control mb-2"
                                    placeholder="No. of Collected Company Names">
                                <input type="number" id="colEmailCount" class="form-control mb-2"
                                    placeholder="No. of Collected Company Emails">
                                <hr>
                            </div>

                            <!-- EMAILS -->
                            <div id="emailsSection" style="display:none;">
                                <h5 class="mb-3">Sending Emails</h5>

                                <div class="input-group mb-2">
                                    <button class="btns btn-primary" id="toggleEmailLocation" type="button">
                                        <i class="bi bi-arrow-repeat"></i>
                                    </button>
                                    <input type="text" id="emailLocation" class="form-control">
                                </div>

                                <input type="text" id="emailMarket" class="form-control mb-2"
                                    placeholder="Market Segment">
                                <input type="text" id="emailProductLine" class="form-control mb-2"
                                    placeholder="Product Line">
                                <input type="number" id="emailCount" class="form-control mb-2"
                                    placeholder="No. of Send Emails">
                                <hr>
                            </div>

                            <!-- WEBMAILS -->
                            <div id="webmailsSection" style="display:none;">
                                <h5 class="mb-3">Sending Webmails</h5>

                                <div class="input-group mb-2">
                                    <button class="btns btn-primary" id="toggleWebmailLocation" type="button">
                                        <i class="bi bi-arrow-repeat"></i>
                                    </button>
                                    <input type="text" id="webmailLocation" class="form-control">
                                </div>

                                <input type="text" id="webmailMarket" class="form-control mb-2"
                                    placeholder="Market Segment">
                                <input type="text" id="webmailProductLine" class="form-control mb-2"
                                    placeholder="Product Line">
                                <input type="number" id="webmailCount" class="form-control mb-2"
                                    placeholder="No. of Sent Webmails">
                                <hr>
                            </div>

                            <!-- RESPONSES -->
                            <div id="responseSection">
                                <h5 class="mb-3">Responses</h5>
                                <input type="number" id="emailsReceived" class="form-control mb-2"
                                    placeholder="Emails Received">
                                <input type="number" id="notInterested" class="form-control mb-2"
                                    placeholder="Not Interested">
                            </div>
                        </div>

                        <!-- RIGHT COLUMN -->
                        <div class="col-md-6">
                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <h5 class="mb-2">Generated Report</h5>
                                <button id="copyReportBtn" class="btns btn-primary">
                                    <i class="bi bi-clipboard"></i> Copy Report
                                </button>
                            </div>
                            <textarea id="dailyReport" class="form-control report-area mb-2" readonly></textarea>
                            <button id="copyReportBtn2" class="btns btn-primary">
                                <i class="bi bi-clipboard"></i> Copy Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- SCRIPT -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {

            const username = localStorage.getItem("username") || "User";

            /* --------------------------------------
               RESTORE SECTION VISIBILITY
            -------------------------------------- */
            const secCol = localStorage.getItem("section_collection") || "show";
            const secEmails = localStorage.getItem("section_emails") || "hide";
            const secWebmails = localStorage.getItem("section_webmails") || "hide";

            collectionSection.style.display = secCol === "show" ? "block" : "none";
            emailsSection.style.display = secEmails === "show" ? "block" : "none";
            webmailsSection.style.display = secWebmails === "show" ? "block" : "none";

            if (secCol === "show") btnCollection.classList.add("active");
            if (secEmails === "show") btnEmails.classList.add("active");
            if (secWebmails === "show") btnWebmails.classList.add("active");

            /* --------------------------------------
               INPUT LOCATION MODES
            -------------------------------------- */
            let colMode = localStorage.getItem("colMode") || "country";
            let emailMode = localStorage.getItem("emailMode") || "country";
            let webmailMode = localStorage.getItem("webmailMode") || "country";

            const colLocation = document.getElementById("colLocation");
            const emailLocation = document.getElementById("emailLocation");
            const webmailLocation = document.getElementById("webmailLocation");

            const emailsReceivedInput = document.getElementById("emailsReceived");
            const notInterestedInput = document.getElementById("notInterested");

            /* --------------------------------------
               RESTORE INPUT VALUES
            -------------------------------------- */
            const ids = [
                "colLocation", "emailLocation", "webmailLocation",
                "colMarket", "emailMarket", "webmailMarket",
                "colCompanyCount", "colEmailCount",
                "emailProductLine", "emailCount",
                "webmailProductLine", "webmailCount",
                "emailsReceived", "notInterested"
            ];

            ids.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.value = localStorage.getItem(id) || "";
            });

            /* --------------------------------------
               MODE PLACEHOLDER APPLY
            -------------------------------------- */
            function applyMode(input, mode) {
                input.placeholder = mode === "country"
                    ? `Country (Click "ðŸ”" to toggle between Country and State)`
                    : `State (Click "ðŸ”" to toggle between Country and State)`;
            }

            applyMode(colLocation, colMode);
            applyMode(emailLocation, emailMode);
            applyMode(webmailLocation, webmailMode);

            /* --------------------------------------
               MODE TOGGLE SAVING
            -------------------------------------- */
            toggleColLocation.onclick = () => {
                colMode = colMode === "country" ? "state" : "country";
                localStorage.setItem("colMode", colMode);
                applyMode(colLocation, colMode);
                generateReport();
            };

            toggleEmailLocation.onclick = () => {
                emailMode = emailMode === "country" ? "state" : "country";
                localStorage.setItem("emailMode", emailMode);
                applyMode(emailLocation, emailMode);
                generateReport();
            };

            toggleWebmailLocation.onclick = () => {
                webmailMode = webmailMode === "country" ? "state" : "country";
                localStorage.setItem("webmailMode", webmailMode);
                applyMode(webmailLocation, webmailMode);
                generateReport();
            };

            /* --------------------------------------
               FORMATTERS
            -------------------------------------- */
            function formatList(input) {
                const txt = (input || "").trim();
                if (!txt) return "";
                const parts = txt.split(/,| and /i).map(s => s.trim()).filter(Boolean);
                if (parts.length === 1) return parts[0];
                if (parts.length === 2) return `${parts[0]} and ${parts[1]}`;
                const last = parts.pop();
                return parts.join(", ") + ", and " + last;
            }

            function labelFor(mode, text) {
                if (!text) return mode === "country" ? "Country" : "State";
                const plural = text.includes(",") || text.includes(" and ");
                if (mode === "country") return plural ? "Countries" : "Country";
                return plural ? "States" : "State";
            }

            /* --------------------------------------
               GENERATE REPORT
            -------------------------------------- */
            function generateReport() {
                const today = new Date().toLocaleDateString("en-US", {
                    year: "numeric",
                    month: "long",
                    day: "numeric"
                });

                /* COLLECTION */
                let collectionText = "";
                if (collectionSection.style.display !== "none") {
                    const txt = formatList(colLocation.value);
                    const label = labelFor(colMode, txt);
                    collectionText =
                        `COMPANY NAME COLLECTION
${label}: ${txt}
Market Segment: ${colMarket.value}
No. of Collected Company Names: ${colCompanyCount.value}
No. of Collected Company Emails: ${colEmailCount.value}`;
                }

                /* EMAILS */
                let emailText = "";
                if (emailsSection.style.display !== "none") {
                    const txt = formatList(emailLocation.value);
                    const label = labelFor(emailMode, txt);
                    emailText =
                        `SENDING EMAILS
${label}: ${txt}
Market Segment: ${emailMarket.value}
Product Line: ${emailProductLine.value}
No. of Send Emails: ${emailCount.value}`;
                }

                /* WEBMAILS */
                let webmailText = "";
                if (webmailsSection.style.display !== "none") {
                    const txt = formatList(webmailLocation.value);
                    const label = labelFor(webmailMode, txt);
                    webmailText =
                        `SENDING WEBMAILS
${label}: ${txt}
Market Segment: ${webmailMarket.value}
Product Line: ${webmailProductLine.value}
No. of Sent Webmails: ${webmailCount.value}`;
                }

                const emailsReceived = emailsReceivedInput.value || "0";
                const notInterested = notInterestedInput.value || "0";

                const sections = [];
                if (collectionText) sections.push(collectionText);
                if (emailText) sections.push(emailText);
                if (webmailText) sections.push(webmailText);

                const body = sections.join("\n\n");

                dailyReport.value =
                    `${today}

${body}

Emails Received: ${emailsReceived}
Not Interested: ${notInterested}

Thank you.

- ${username}`.trim();
            }

            /* --------------------------------------
               SAVE SECTION TOGGLE STATES
            -------------------------------------- */
            btnCollection.onclick = () => {
                const show = collectionSection.style.display === "none";
                collectionSection.style.display = show ? "block" : "none";
                btnCollection.classList.toggle("active");
                localStorage.setItem("section_collection", show ? "show" : "hide");
                generateReport();
            };

            btnEmails.onclick = () => {
                const show = emailsSection.style.display === "none";
                emailsSection.style.display = show ? "block" : "none";
                btnEmails.classList.toggle("active");
                localStorage.setItem("section_emails", show ? "show" : "hide");
                generateReport();
            };

            btnWebmails.onclick = () => {
                const show = webmailsSection.style.display === "none";
                webmailsSection.style.display = show ? "block" : "none";
                btnWebmails.classList.toggle("active");
                localStorage.setItem("section_webmails", show ? "show" : "hide");
                generateReport();
            };

            /* --------------------------------------
               AUTO SAVE INPUT VALUES
            -------------------------------------- */
            document.querySelectorAll("input").forEach(inp => {
                inp.addEventListener("input", () => {
                    localStorage.setItem(inp.id, inp.value);
                    generateReport();
                });
            });

            copyReportBtn.onclick = () => {
                navigator.clipboard.writeText(dailyReport.value);
            };

            copyReportBtn2.onclick = () => {
                navigator.clipboard.writeText(dailyReport.value);
            };

            // RESET BUTTON
            resetBtn.onclick = () => {
                // Reset input values
                const inputIds = [
                    "colLocation", "emailLocation", "webmailLocation",
                    "colMarket", "emailMarket", "webmailMarket",
                    "colCompanyCount", "colEmailCount",
                    "emailProductLine", "emailCount",
                    "webmailProductLine", "webmailCount",
                    "emailsReceived", "notInterested"
                ];

                inputIds.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.value = "";
                    localStorage.removeItem(id);
                });

                // Reset modes
                colMode = "country";
                emailMode = "country";
                webmailMode = "country";

                localStorage.setItem("colMode", colMode);
                localStorage.setItem("emailMode", emailMode);
                localStorage.setItem("webmailMode", webmailMode);

                applyMode(colLocation, colMode);
                applyMode(emailLocation, emailMode);
                applyMode(webmailLocation, webmailMode);

                // Reset section visibility
                collectionSection.style.display = "block";
                emailsSection.style.display = "none";
                webmailsSection.style.display = "none";

                btnCollection.classList.add("active");
                btnEmails.classList.remove("active");
                btnWebmails.classList.remove("active");

                localStorage.setItem("section_collection", "show");
                localStorage.setItem("section_emails", "hide");
                localStorage.setItem("section_webmails", "hide");

                // Regenerate report
                generateReport();
            };

            // WELCOME USER
            const welcomeMsg = document.getElementById("welcomeMsg");
            welcomeMsg.textContent = `Welcome, ${username}`;

            // DATE AND TIME
            const currentDate = document.getElementById("currentDate");
            const currentTime = document.getElementById("currentTime");

            function updateDateTime() {
                const now = new Date();

                // Format date: November 20, 2025
                const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
                currentDate.textContent = now.toLocaleDateString('en-US', dateOptions);

                // Format time: 11:00:45 pm
                let hours = now.getHours();
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                const ampm = hours >= 12 ? 'pm' : 'am';
                hours = hours % 12;
                hours = hours ? hours : 12; // hour '0' should be '12'
                currentTime.textContent = `${hours}:${minutes}:${seconds} ${ampm}`;
            }

            // Initial call
            updateDateTime();
            // Update every second
            setInterval(updateDateTime, 1000);

            const holidays = [
                // Regular Holidays
                new Date(2025, 0, 1),    // Jan 1 â€” New Yearâ€™s Day
                new Date(2025, 3, 9),    // Apr 9 â€” Araw ng Kagitingan
                new Date(2025, 3, 17),   // Apr 17 â€” Maundy Thursday
                new Date(2025, 3, 18),   // Apr 18 â€” Good Friday
                new Date(2025, 4, 1),    // May 1 â€” Labor Day
                new Date(2025, 5, 12),   // Jun 12 â€” Independence Day
                new Date(2025, 7, 25),   // Aug 25 â€” National Heroes Day (last Monday of Aug)
                new Date(2025, 10, 30),  // Nov 30 â€” Bonifacio Day
                new Date(2025, 11, 25),  // Dec 25 â€” Christmas Day
                new Date(2025, 11, 30),  // Dec 30 â€” Rizal Day

                // Special (Non-Working) Days
                new Date(2025, 0, 29),   // Jan 29 â€” Chinese New Year
                new Date(2025, 3, 19),   // Apr 19 â€” Black Saturday
                new Date(2025, 7, 21),   // Aug 21 â€” Ninoy Aquino Day
                new Date(2025, 9, 31),   // Oct 31 â€” All Saintsâ€™ Day Eve
                new Date(2025, 10, 1),   // Nov 1 â€” All Saintsâ€™ Day
                new Date(2025, 11, 8),   // Dec 8 â€” Feast of the Immaculate Conception
                new Date(2025, 11, 24),  // Dec 24 â€” Christmas Eve
                new Date(2025, 11, 31),  // Dec 31 â€” Last Day of the Year
            ];

            function isWorkingDay(date) {
                const day = date.getDay();
                // Weekend or holiday
                return day !== 0 && day !== 6 && !holidays.some(h =>
                    h.getFullYear() === date.getFullYear() &&
                    h.getMonth() === date.getMonth() &&
                    h.getDate() === date.getDate()
                );
            }

            function adjustToWorkingDay(date) {
                let adjusted = new Date(date);
                while (!isWorkingDay(adjusted)) {
                    adjusted.setDate(adjusted.getDate() - 1);
                }
                return adjusted;
            }

            function nextPayday(today = new Date()) {
                const year = today.getFullYear();
                const month = today.getMonth();
                const fifteenth = new Date(year, month, 15);
                const lastDay = new Date(year, month + 1, 0);

                let payday = today <= fifteenth ? fifteenth : lastDay;
                // Adjust if payday falls on weekend or holiday
                return adjustToWorkingDay(payday);
            }

            function workingDaysBetween(start, end) {
                let count = 0;
                let current = new Date(start);
                while (current < end) {
                    if (isWorkingDay(current)) count++;
                    current.setDate(current.getDate() + 1);
                }
                return count;
            }

            function formatDate(date) {
                return date.toLocaleDateString('en-US', {
                    month: 'long',
                    day: 'numeric'
                });
            }

            // Calculate payday and remaining working days
            const today = new Date();
            const payday = nextPayday(today);
            const workdaysLeft = workingDaysBetween(today, payday);

            const paydayMsg = document.getElementById("paydayMsg");
            if (workdaysLeft === 0) {
                paydayMsg.textContent = `Today is payday! (${formatDate(payday)})`;
            } else {
                paydayMsg.textContent = `${workdaysLeft} working day${workdaysLeft !== 1 ? "s" : ""} left before pay day! ${formatDate(payday)}`;
            }



            generateReport();

            const fy = document.getElementById("footer-year");
            if (fy) fy.textContent = new Date().getFullYear();
        });
    </script>

    <script src="assets/js/main.js"></script>
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
</body>

</html>